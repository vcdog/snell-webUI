# 暗黑模式功能实现文档

## 功能说明

Snell Panel 现已支持完整的暗黑模式功能，包括三种主题模式及跟随系统自动切换。

## 支持的主题模式

### 1. 🌞 浅色模式 (Light Mode)
- 适合白天使用
- 明亮的白色背景
- 深色文字
- 柔和的色彩

### 2. 🌙 深色模式 (Dark Mode)
- 适合夜间使用
- 深色背景 (#09090b)
- 浅色文字
- 减少蓝光刺激

### 3. 🔄 自动模式 (Auto Mode)
- **默认模式**
- 自动跟随系统主题设置
- 系统切换主题时自动同步
- 无需手动调整

## UI 设计

### 主界面（index.html）
- **位置**: 右上角按钮组（GitHub 和 Telegram 图标旁边）
- **图标**: 根据当前模式显示对应图标
  - ☀️ 太阳图标 - 浅色模式
  - 🌙 月亮图标 - 深色模式
  - ⚪ 组合图标 - 自动模式

### 登录页面（login.html）
- **位置**: 右上角浮动按钮
- **样式**: 固定定位，始终可见
- **功能**: 与主界面相同

## 工作原理

### 技术实现

#### 1. CSS 变量系统
使用 CSS 自定义属性定义颜色：

```css
:root {
    /* 浅色模式变量 */
    --color-white: #ffffff;
    --color-gray-50: #fafafa;
    ...
}

[data-theme="dark"] {
    /* 深色模式变量 */
    --color-white: #09090b;
    --color-gray-50: #18181b;
    ...
}
```

#### 2. 媒体查询检测
自动检测系统主题：

```css
@media (prefers-color-scheme: dark) {
    :root:not([data-theme="light"]) {
        /* 自动应用深色模式 */
    }
}
```

#### 3. JavaScript 控制
主题切换逻辑 (`theme.js`):

```javascript
// 三种模式循环切换
auto → light → dark → auto

// 保存用户偏好
localStorage.setItem('theme', currentTheme);

// 应用主题
html.setAttribute('data-theme', theme);
```

## 使用方法

### 用户操作

1. **切换主题**:
   - 点击右上角主题图标
   - 每次点击循环切换：自动 → 浅色 → 深色 → 自动

2. **查看当前模式**:
   - 查看图标即可识别
   - 切换时显示 Toast 提示

### 自动切换

当设置为"自动模式"时：
1. 白天（系统浅色主题）→ 显示浅色界面
2. 晚上（系统深色主题）→ 显示深色界面
3. 系统切换时自动同步，无需刷新

## 颜色方案

### 浅色模式
| 元素 | 颜色 | 说明 |
|------|------|------|
| 主背景 | #ffffff | 纯白 |
| 次背景 | #fafafa | 浅灰 |
| 主文字 | #18181b | 深黑 |
| 次文字 | #52525b | 中灰 |
| 边框 | #e4e4e7 | 浅灰 |

### 深色模式
| 元素 | 颜色 | 说明 |
|------|------|------|
| 主背景 | #09090b | 近黑 |
| 次背景 | #18181b | 深灰 |
| 主文字 | #fafafa | 浅白 |
| 次文字 | #d4d4d8 | 浅灰 |
| 边框 | #3f3f46 | 中灰 |

## 文件结构

### 新增文件

| 文件 | 用途 |
|------|------|
| `dark-mode.css` | 暗黑模式样式定义 |
| `theme.js` | 主题管理 JavaScript |
| `DARK_MODE.md` | 本说明文档 |

### 修改文件

| 文件 | 修改内容 |
|------|---------|
| `index.html` | 添加主题切换按钮和引用 |
| `login.html` | 添加主题切换按钮和引用 |

## 特性

### ✅ 已实现

- [x] 三种主题模式（浅色、深色、自动）
- [x] 跟随系统自动切换
- [x] 用户偏好持久化（localStorage）
- [x] 平滑过渡动画
- [x] 主界面和登录页支持
- [x] Toast 提示反馈
- [x] 图标状态显示

### 🎨 优化细节

- **平滑过渡**: 所有颜色变化都有过渡动画
- **深色优化**: 阴影、边框等针对深色模式优化
- **性能**: CSS 变量切换，性能优秀
- **兼容性**: 支持所有现代浏览器

## 浏览器兼容性

| 浏览器 | 最低版本 | 状态 |
|--------|---------|------|
| Chrome | 76+ | ✅ 完全支持 |
| Firefox | 67+ | ✅ 完全支持 |
| Safari | 12.1+ | ✅ 完全支持 |
| Edge | 79+ | ✅ 完全支持 |
| Opera | 63+ | ✅ 完全支持 |

## 开发指南

### 添加新组件

使用 CSS 变量确保暗黑模式兼容：

```css
.my-component {
    /* ✅ 正确 - 使用变量 */
    background: var(--color-white);
    color: var(--color-gray-900);
    border: 1px solid var(--color-gray-200);
}

.my-component {
    /* ❌ 错误 - 硬编码颜色 */
    background: #ffffff;
    color: #18181b;
    border: 1px solid #e4e4e7;
}
```

### 自定义颜色

如需添加新颜色，在 `dark-mode.css` 中定义：

```css
:root {
    --custom-color-light: #yourcolor;
}

[data-theme="dark"] {
    --custom-color-light: #yourcolor-dark;
}
```

## 故障排查

### 问题：主题不切换

**解决方案**:
1. 清除浏览器缓存（Ctrl + Shift + R）
2. 检查 `theme.js` 是否加载
3. 检查浏览器控制台错误

### 问题：颜色显示异常

**解决方案**:
1. 确认使用 CSS 变量而非硬编码颜色
2. 检查 `dark-mode.css` 是否正确加载
3. 验证变量名是否正确

### 问题：系统主题不自动切换

**解决方案**:
1. 确保当前模式为"自动模式"
2. 检查浏览器是否支持 `prefers-color-scheme`
3. 验证系统主题设置是否正确

## 最佳实践

### 1. 保持一致性
- 所有组件使用相同的 CSS 变量
- 遵循既定的颜色方案

### 2. 测试两种模式
- 新功能需在两种模式下测试
- 确保文字可读性

### 3. 性能优化
- 避免过度使用过渡动画
- 使用 CSS 变量提升性能

## 更新日志

### v2.0 (2026-02-03)
- ✨ 新增完整暗黑模式支持
- ✨ 三种主题模式（浅色、深色、自动）
- ✨ 跟随系统自动切换
- ✨ 用户偏好持久化
- ✨ 登录页面主题支持
- 🎨 优化配色方案
- 🎨 平滑过渡动画

---

**文档版本**: v1.0  
**更新时间**: 2026-02-03 14:35  
**作者**: Snell Panel Team
