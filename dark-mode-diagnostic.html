<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ·±è‰²æ¨¡å¼è¯Šæ–­å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
            background: #f5f5f5;
        }

        .diagnostic-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .diagnostic-card h2 {
            margin-top: 0;
            color: #4f46e5;
        }

        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
        }

        .test-pass {
            background: #d1fae5;
            border-left: 4px solid #10b981;
        }

        .test-fail {
            background: #fee2e2;
            border-left: 4px solid #ef4444;
        }

        button {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }

        button:hover {
            background: #4338ca;
        }

        .color-box {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 10px;
            border: 1px solid #ccc;
            vertical-align: middle;
        }

        code {
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>

<body>
    <h1>ğŸ”§ æ·±è‰²æ¨¡å¼è¯Šæ–­å·¥å…·</h1>

    <div class="diagnostic-card">
        <h2>1. CSS æ–‡ä»¶æ£€æŸ¥</h2>
        <div id="css-check"></div>
        <button onclick="checkCSSFiles()">æ£€æŸ¥ CSS æ–‡ä»¶</button>
    </div>

    <div class="diagnostic-card">
        <h2>2. ä¸»é¢˜çŠ¶æ€æ£€æŸ¥</h2>
        <div id="theme-check"></div>
        <button onclick="checkThemeState()">æ£€æŸ¥ä¸»é¢˜çŠ¶æ€</button>
    </div>

    <div class="diagnostic-card">
        <h2>3. é¢œè‰²å˜é‡æ£€æŸ¥</h2>
        <div id="color-check"></div>
        <button onclick="checkColorVariables()">æ£€æŸ¥é¢œè‰²å˜é‡</button>
    </div>

    <div class="diagnostic-card">
        <h2>4. å¿«é€Ÿä¿®å¤å·¥å…·</h2>
        <button onclick="applyQuickFix()">åº”ç”¨ä¸´æ—¶ä¿®å¤ï¼ˆç›´æ¥è®¾ç½®é¢œè‰²ï¼‰</button>
        <button onclick="clearCache()">æ‰“å¼€æ¸…é™¤ç¼“å­˜é¡µé¢</button>
        <div id="fix-result"></div>
    </div>

    <div class="diagnostic-card">
        <h2>5. ç™»å½•é¡µé¢é¢„è§ˆ</h2>
        <button onclick="openLoginPage()">åœ¨æ–°æ ‡ç­¾æ‰“å¼€ç™»å½•é¡µ</button>
        <button onclick="openLoginPageIncognito()">åœ¨æ— ç—•æ¨¡å¼æ‰“å¼€ï¼ˆæ¨èï¼‰</button>
    </div>

    <script>
        function checkCSSFiles() {
            const result = document.getElementById('css-check');
            let html = '<h3>æ£€æŸ¥ç»“æœï¼š</h3>';

            // Check if dark-mode.css exists
            const stylesheets = Array.from(document.styleSheets);
            const darkModeCSS = stylesheets.find(sheet =>
                sheet.href && sheet.href.includes('dark-mode.css')
            );

            if (darkModeCSS) {
                html += '<div class="test-pass">âœ… dark-mode.css å·²åŠ è½½</div>';
                html += `<div class="test-pass">æ–‡ä»¶è·¯å¾„: ${darkModeCSS.href}</div>`;
            } else {
                html += '<div class="test-fail">âŒ dark-mode.css æœªæ‰¾åˆ°</div>';
                html += '<div class="test-fail">è¯·ç¡®ä¿ HTML ä¸­åŒ…å«: &lt;link rel="stylesheet" href="dark-mode.css"&gt;</div>';
            }

            // Check network
            fetch('../dark-mode.css')
                .then(response => {
                    if (response.ok) {
                        html += '<div class="test-pass">âœ… dark-mode.css ç½‘ç»œå¯è®¿é—®</div>';
                        return response.text();
                    } else {
                        html += '<div class="test-fail">âŒ dark-mode.css ç½‘ç»œä¸å¯è®¿é—® (çŠ¶æ€: ' + response.status + ')</div>';
                    }
                })
                .then(text => {
                    if (text && text.includes('form-group label')) {
                        html += '<div class="test-pass">âœ… CSS å†…å®¹åŒ…å«ä¿®å¤ä»£ç </div>';
                    } else if (text) {
                        html += '<div class="test-fail">âŒ CSS å†…å®¹å¯èƒ½ä¸å®Œæ•´</div>';
                    }
                    result.innerHTML = html;
                })
                .catch(err => {
                    html += '<div class="test-fail">âŒ åŠ è½½ CSS æ—¶å‡ºé”™: ' + err.message + '</div>';
                    result.innerHTML = html;
                });

            result.innerHTML = html;
        }

        function checkThemeState() {
            const result = document.getElementById('theme-check');
            const htmlElement = document.documentElement;
            const theme = htmlElement.getAttribute('data-theme');
            const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

            let html = '<h3>å½“å‰çŠ¶æ€ï¼š</h3>';
            html += `<div class="test-result">data-theme å±æ€§: <code>${theme || 'æœªè®¾ç½®ï¼ˆè‡ªåŠ¨æ¨¡å¼ï¼‰'}</code></div>`;
            html += `<div class="test-result">ç³»ç»Ÿåå¥½: <code>${systemPrefersDark ? 'æ·±è‰²' : 'æµ…è‰²'}</code></div>`;

            if (theme === 'dark') {
                html += '<div class="test-pass">âœ… æ·±è‰²æ¨¡å¼å·²æ¿€æ´»ï¼ˆæ‰‹åŠ¨ï¼‰</div>';
            } else if (theme === 'light') {
                html += '<div class="test-result">âšª æµ…è‰²æ¨¡å¼å·²æ¿€æ´»</div>';
            } else if (systemPrefersDark) {
                html += '<div class="test-pass">âœ… æ·±è‰²æ¨¡å¼åº”è¯¥å·²æ¿€æ´»ï¼ˆè‡ªåŠ¨ï¼‰</div>';
            } else {
                html += '<div class="test-result">âšª æµ…è‰²æ¨¡å¼åº”è¯¥å·²æ¿€æ´»ï¼ˆè‡ªåŠ¨ï¼‰</div>';
            }

            result.innerHTML = html;
        }

        function checkColorVariables() {
            const result = document.getElementById('color-check');
            const root = document.documentElement;
            const style = getComputedStyle(root);

            const colors = {
                '--color-gray-200': '#3f3f46',
                '--color-gray-700': '#e4e4e7',
                '--color-gray-900': '#fafafa'
            };

            let html = '<h3>CSS å˜é‡å€¼ï¼š</h3>';

            for (const [varName, expectedDark] of Object.entries(colors)) {
                const value = style.getPropertyValue(varName).trim();
                html += `<div class="test-result">`;
                html += `<span class="color-box" style="background: ${value}"></span>`;
                html += `${varName}: <code>${value}</code>`;
                html += `</div>`;
            }

            result.innerHTML = html;
        }

        function applyQuickFix() {
            const result = document.getElementById('fix-result');

            try {
                // This is for the login page
                const style = document.createElement('style');
                style.textContent = `
                    [data-theme="dark"] .form-group label {
                        color: #e4e4e7 !important;
                    }
                    [data-theme="dark"] .checkbox-label {
                        color: #d4d4d8 !important;
                    }
                    [data-theme="dark"] .login-card {
                        background: rgba(24, 24, 27, 0.95) !important;
                    }
                    [data-theme="dark"] .form-input {
                        background: #27272a !important;
                        color: #fafafa !important;
                    }
                `;
                document.head.appendChild(style);

                result.innerHTML = '<div class="test-pass">âœ… ä¸´æ—¶ä¿®å¤å·²åº”ç”¨ï¼è¯·åˆ·æ–°ç™»å½•é¡µæŸ¥çœ‹æ•ˆæœã€‚</div>';
            } catch (err) {
                result.innerHTML = '<div class="test-fail">âŒ åº”ç”¨å¤±è´¥: ' + err.message + '</div>';
            }
        }

        function clearCache() {
            alert('è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ¸…é™¤ç¼“å­˜ï¼š\n\n1. æŒ‰ Ctrl + Shift + Delete\n2. é€‰æ‹©"å…¨éƒ¨"æ—¶é—´èŒƒå›´\n3. å‹¾é€‰"ç¼“å­˜çš„å›¾ç‰‡å’Œæ–‡ä»¶"\n4. ç‚¹å‡»"æ¸…é™¤æ•°æ®"');
            window.open('chrome://settings/clearBrowserData', '_blank');
        }

        function openLoginPage() {
            window.open('../login.html', '_blank');
        }

        function openLoginPageIncognito() {
            alert('æ— æ³•è‡ªåŠ¨æ‰“å¼€æ— ç—•æ¨¡å¼çª—å£ã€‚\n\nè¯·æ‰‹åŠ¨æ“ä½œï¼š\n1. æŒ‰ Ctrl + Shift + N æ‰“å¼€æ— ç—•çª—å£\n2. è®¿é—®ç™»å½•é¡µé¢\n3. æµ‹è¯•æ·±è‰²æ¨¡å¼');
        }

        // Auto-run checks on load
        window.addEventListener('DOMContentLoaded', () => {
            checkThemeState();
        });
    </script>
</body>

</html>