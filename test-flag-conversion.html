<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›½æ——è½¬æ¢æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }

        .flag-display {
            font-size: 32px;
            margin: 10px 0;
        }

        .code-display {
            font-family: monospace;
            background: #fff;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }

        button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #0056b3;
        }

        .result {
            margin-top: 15px;
            padding: 10px;
            background: white;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <h1>ğŸš© å›½æ——è½¬æ¢åŠŸèƒ½æµ‹è¯•</h1>

    <div class="test-section">
        <h2>1. å‡½æ•°æµ‹è¯•</h2>
        <button onclick="testFunction()">æµ‹è¯• countryCodeToFlag å‡½æ•°</button>
        <div id="function-test-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>2. å›½å®¶ä»£ç è½¬æ¢ç¤ºä¾‹</h2>
        <div class="flag-display">
            <strong>US â†’</strong> <span id="flag-us"></span><br>
            <strong>GB â†’</strong> <span id="flag-gb"></span><br>
            <strong>KR â†’</strong> <span id="flag-kr"></span><br>
            <strong>CN â†’</strong> <span id="flag-cn"></span><br>
            <strong>JP â†’</strong> <span id="flag-jp"></span><br>
        </div>
    </div>

    <div class="test-section">
        <h2>3. æ¨¡æ‹ŸèŠ‚ç‚¹æ•°æ®</h2>
        <button onclick="testWithNodeData()">ä½¿ç”¨èŠ‚ç‚¹æ•°æ®æµ‹è¯•</button>
        <div id="node-test-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>4. ç»Ÿè®¡åŒºåŸŸæ¨¡æ‹Ÿ</h2>
        <p>æ¨¡æ‹Ÿå®é™…é¡µé¢çš„ç»Ÿè®¡åŒºåŸŸï¼š</p>
        <div class="stat-locations" id="test-stat-locations" style="font-size: 24px;">
            <span class="no-data">ç­‰å¾…æµ‹è¯•...</span>
        </div>
        <button onclick="testStatsDisplay()">ç”Ÿæˆç»Ÿè®¡å›¾æ ‡</button>
    </div>

    <script>
        /**
         * Convert country code to flag emoji
         * è¿™æ˜¯ä» app.js å¤åˆ¶çš„å®Œå…¨ç›¸åŒçš„å‡½æ•°
         */
        function countryCodeToFlag(countryCode) {
            if (!countryCode || countryCode.length !== 2) return '';
            const codePoints = countryCode
                .toUpperCase()
                .split('')
                .map(char => 0x1F1E6 + char.charCodeAt(0) - 65);
            return String.fromCodePoint(...codePoints);
        }

        // æµ‹è¯•1: å‡½æ•°åŸºç¡€æµ‹è¯•
        function testFunction() {
            const result = document.getElementById('function-test-result');
            const tests = [
                { code: 'US', expected: 'ğŸ‡ºğŸ‡¸' },
                { code: 'GB', expected: 'ğŸ‡¬ğŸ‡§' },
                { code: 'KR', expected: 'ğŸ‡°ğŸ‡·' },
                { code: 'us', expected: 'ğŸ‡ºğŸ‡¸' },  // æµ‹è¯•å°å†™
                { code: '', expected: '' },       // æµ‹è¯•ç©ºå­—ç¬¦ä¸²
            ];

            let html = '<h3>æµ‹è¯•ç»“æœï¼š</h3>';
            tests.forEach(test => {
                const actual = countryCodeToFlag(test.code);
                const status = actual === test.expected ? 'âœ…' : 'âŒ';
                html += `<div>${status} countryCodeToFlag('${test.code}') = ${actual || '(ç©º)'}</div>`;
            });

            result.innerHTML = html;
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ˜¾ç¤ºå›½æ——
        window.addEventListener('DOMContentLoaded', () => {
            document.getElementById('flag-us').textContent = countryCodeToFlag('US');
            document.getElementById('flag-gb').textContent = countryCodeToFlag('GB');
            document.getElementById('flag-kr').textContent = countryCodeToFlag('KR');
            document.getElementById('flag-cn').textContent = countryCodeToFlag('CN');
            document.getElementById('flag-jp').textContent = countryCodeToFlag('JP');
        });

        // æµ‹è¯•2: ä½¿ç”¨èŠ‚ç‚¹æ•°æ®
        function testWithNodeData() {
            const result = document.getElementById('node-test-result');

            // æ¨¡æ‹Ÿä»åç«¯è·å–çš„èŠ‚ç‚¹æ•°æ®
            const mockNodes = [
                { id: 1, country_code: 'US', node_name: 'ç¾å›½èŠ‚ç‚¹' },
                { id: 2, country_code: 'GB', node_name: 'è‹±å›½èŠ‚ç‚¹' },
                { id: 3, country_code: 'KR', node_name: 'éŸ©å›½èŠ‚ç‚¹' },
                { id: 4, country_code: 'US', node_name: 'ç¾å›½èŠ‚ç‚¹2' },
            ];

            // æå–å”¯ä¸€çš„å›½å®¶ä»£ç 
            const countries = [...new Set(mockNodes.map(n => n.country_code).filter(Boolean))];

            let html = '<h3>èŠ‚ç‚¹æ•°æ®ï¼š</h3>';
            html += `<p>æ€»èŠ‚ç‚¹æ•°: ${mockNodes.length}</p>`;
            html += `<p>å›½å®¶/åœ°åŒºæ•°: ${countries.length}</p>`;
            html += '<h3>å›½å®¶åˆ—è¡¨ï¼š</h3>';
            html += '<div style="font-size: 32px;">';

            countries.forEach(code => {
                const flag = countryCodeToFlag(code);
                html += `<span title="${code}">${flag}</span> `;
            });

            html += '</div>';
            result.innerHTML = html;
        }

        // æµ‹è¯•3: ç»Ÿè®¡åŒºåŸŸæ˜¾ç¤º
        function testStatsDisplay() {
            const locationsContainer = document.getElementById('test-stat-locations');

            // æ¨¡æ‹Ÿå®é™…çš„å›½å®¶ä»£ç æ•°ç»„
            const countries = ['US', 'GB', 'KR'];

            // ä½¿ç”¨ä¸ app.js å®Œå…¨ç›¸åŒçš„ä»£ç 
            if (countries.length > 0) {
                locationsContainer.innerHTML = countries.map(code =>
                    `<span class="country-flag" title="${code}">${countryCodeToFlag(code)}</span>`
                ).join('');
            } else {
                locationsContainer.innerHTML = '<span class="no-data">æš‚æ— èŠ‚ç‚¹é…ç½®</span>';
            }
        }

        // è‡ªåŠ¨è¿è¡Œæ‰€æœ‰æµ‹è¯•
        window.addEventListener('DOMContentLoaded', () => {
            console.log('=== å›½æ——è½¬æ¢æµ‹è¯• ===');
            console.log('countryCodeToFlag("US") =', countryCodeToFlag('US'));
            console.log('countryCodeToFlag("GB") =', countryCodeToFlag('GB'));
            console.log('countryCodeToFlag("KR") =', countryCodeToFlag('KR'));
            console.log('=====================');
        });
    </script>
</body>

</html>